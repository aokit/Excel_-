新しいモジュールを追加することができるが、
シートができるタイミングが遅くなるのか、Module1からのコピーができないという状況。

シートで使う関数の関数定義 ( Function ... End Function ) は、 標準モジュールに設置すること。
そうしていないと、シートで参照したときに NAME# エラーが生じる。

組織名変換のためのサブルーチンを作ることにした。
＝＝＝＝＝＝＝＝
belong2whom(組織定義の領域,参照領域,所属領域）
＝＝＝＝
参照領域にある文字列を、組織定義の領域で検索し、帰属領域に結果を書き込む。

《組織定義の領域》
下位組織名Bが帰属する上位組織名A（さらには、上位組織名Aが保有する下位組織名B）
を以下の正規表現で列に配置した領域。上位組織名Aと同じ組織名を下位組織名Bとして
有する場合があるが明記しない。また、下位組織名Bの無い上位組織名Aもありうる。
(A(B*))+
上位組織Aと下位組織Bはセルの背景色によって識別される。
領域の第１行の背景色によって、上位組織が定義される。

《参照領域》
帰属する上位組織名Aを得たい下位組織名Bを列に配置したもの

《帰属領域》
帰属することがわかった上位組織名Aを書き込む領域

なお、参照領域と所属領域は同じ行数の１列領域であること。
＝＝＝＝＝＝＝＝

＝＝＝＝
ひとまずは、Excelシートの整理をして、255件に対応できるようにはした。
組織の計数ための親組織の処理に、セルの背景色の判別をFunctionで行っている。
このスクリプトはシートに置くことができない。
しかし、１年間の取引（６００件程度）を取り扱うときに同じ取扱ができないかもしれず、
仕向地の扱いも付け焼き刃であり、判断根拠も残りにくい。
以下の処理を VBA で書いてみようと考える。
＝＝＝＝

■例外の有無と例外がある場合その取り扱いについて多少の違いのある３通りの頻度計数処理を行う

１：BU名の親組織計数
・BU名を親組織に組み入れて計数する。
・以下の例外が起きる
旧組織等（親組織が記載されていないBU）を現行の親組織に組み入れる
・すべて例外もふくめ、かならずどれか１つの親組織として計数する。

２：取引区分の計数
・例外はなく、あらかじめ設定した取引内容種別のいずれか１つの取引区分として計数する。

３：仕向地の計数
・以下の例外が起きる
A:いずれか１つの仕向地となるが表記が異なるもの
B:複数の仕向地として表記されているもの
・Aの例外は、割り当てた１つの仕向地として計数する。
・Bの例外は、割り当てた複数の仕向地についてそれぞれ１つとして計数する。
　（頻度の総和が増えることになる）
・すべての例外も含め、かならずどれか１つもしくは複数の仕向地として計数する。

■仕向地については例外のある金額集計を得る

・以下の例外が起きる
A:いずれか１つの仕向地となるが表記が異なるもの
B:複数の仕向地として表記されているもの
・Aの例外は、割り当てた１つの仕向地として金額集計する。
・Bの例外は、割り当てた複数の仕向地に等分とみなして金額集計する。
　（金額集計の総和は増えない）
・すべての例外も含め、金額のどの部分もどれかの仕向地の金額集計に組み入れられる。

＝＝＝＝
１と３Aおよび３Bのために、例外の検出・例外に対する処理の指定・結果の確認の処理
ループが必要になる。

＝＝＝＝
入力１：集計の期間等の設定
出力１：組織計数・・・・・ついでに組織金額集計
出力２（入力２）：組織の例外（とその取扱指定）
出力３：取引区分計数・・・ついでに取引区分金額集計
出力４：仕向地計数・・・・ついでに仕向地金額集計
出力５（入力３）：仕向地の例外（とその取扱指定）
＝＝＝＝
こんな感じか。


